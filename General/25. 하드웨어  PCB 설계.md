# 25. 하드웨어 / PCB 설계

## 25.1 STM32 보드 전원 회로 설계

STM32 기반 보드를 설계할 때 전원 회로(Power Circuit)는 시스템 안정성과 신뢰성에 직접적인 영향을 미치는 핵심 요소다. MCU의 동작 전압, 주변 센서·액추에이터의 전력 요구사항, 전원 소스(USB, 배터리, 어댑터 등), 전압 강하, 리플(Noise) 특성 등을 종합적으로 고려해야 한다. 본 절에서는 STM32 보드의 전원 공급 구조를 체계적으로 설계하는 절차와 각 구성요소의 구체적 역할을 다룬다.

------

### 전원 입력 구조 설계

STM32 보드는 일반적으로 **5V USB 입력**, **DC 잭(7–12V)**, 또는 **리튬 배터리(3.7V)** 중 하나를 사용한다. 입력 전원은 LDO 또는 DC-DC Converter를 통해 3.3V로 변환되어 MCU 및 주변 회로에 공급된다.

#### 주요 입력 방식

- **USB 5V 입력 (VBUS)**
  - Micro USB 또는 USB Type-C 포트를 통해 5V 입력.
  - ESD 보호 소자(TVS diode) 추가 필수.
  - STM32의 USB 기능을 사용할 경우 VBUS 검출 회로 필요 (`VBUS_SENSE` 핀 연결).
- **DC Barrel Jack 입력**
  - 7~12V 입력 시, LDO로 직접 변환 시 발열 가능성이 크므로 DC-DC 변환 권장.
  - Reverse Polarity Protection을 위해 다이오드(SS14) 또는 P-Channel MOSFET 회로 사용.
- **Li-ion / Li-Po 배터리 입력**
  - 3.7V nominal (4.2V fully charged).
  - 저전압 차단 회로 (Undervoltage Protection, 3.0V 이하 차단) 필수.
  - 충전 IC (예: TP4056, MCP73831)와 보호 회로를 결합하여 안정적 충전 관리.

------

### 전압 변환부 설계

#### LDO (Low Dropout Regulator)

- 간단하고 저노이즈 특성이 우수하나, 입력 전압과 출력 전압의 차가 클 경우 발열이 크다.
- 예: **AMS1117-3.3**, **LD1117**, **XC6206**, **MIC5504** 등
- 입력–출력 전압차(ΔV) 최소 1V 확보 권장.
- 출력 커패시터 ESR 조건(LDO 데이터시트 참조) 반드시 준수.

#### DC-DC Converter (Buck Converter)

- 고효율 변환 (80~95%)으로 발열이 적고 배터리 구동에 유리.
- 예: **MP1584**, **LM2596**, **AP63203**, **TPS62160** 등
- 인덕터, 쇼트키 다이오드, 피드백 저항 설계 주의.
- 스위칭 주파수에 따른 EMI 대책(필터, GND Plane 분리) 필요.
- 필수 보호 회로:
  - Input Capacitor (10–47 µF)
  - Output Capacitor (22–100 µF)
  - Schottky Diode (Fast Recovery)
  - Output LC 필터 (노이즈 저감용)

------

### 전원 분배 및 필터링

#### 전원 레일 구성 예시

| 전압 | 대상 회로             | 전원 변환           |
| ---- | --------------------- | ------------------- |
| 3.3V | STM32, 센서, 로직 IC  | LDO / DC-DC         |
| 5V   | USB, 릴레이, 백라이트 | USB 직결 또는 Boost |
| 12V  | 모터, 릴레이 모듈     | 외부 전원 어댑터    |

#### 필터링 구성

- 전원 입력단: EMI 필터 (Ferrite Bead + Capacitor + TVS)
- MCU 근처: 100 nF × 여러 개 (VDD/VSS 근처에 직접 배치)
- 아날로그 회로 근처: 10 µF + 100 nF 병렬 구성
- ADC 회로에는 별도의 LDO 또는 Ferrite Bead로 아날로그 전원(VREF, VDDA) 분리

------

### 전원 보호 회로

#### 과전류 / 과전압 보호

- **퓨즈(Fuse)** 또는 **PTC (Resettable Fuse)** 를 5V 입력단에 삽입.
- **TVS 다이오드**를 USB 5V 라인 또는 DC 입력단에 삽입하여 서지(Surge) 차단.

#### 역극성 보호

- 다이오드 직렬 연결 방식: 간단하나 전압 강하(0.6 V) 존재.
- P-MOSFET 역극성 보호 회로: 전압 강하 거의 없음, 고효율 구조.

#### 전원 시퀀싱

- STM32 및 외부 장치가 특정 순서로 전원 인가되어야 하는 경우,
   Power-Good 신호 또는 Supervisor IC 사용.
   (예: `STM32_PWR_ON` 제어 후 `VDD_3V3` 인가)

------

### 전원 안정성 검증

#### 전압 리플 및 노이즈 측정

- 오실로스코프로 3.3 V 라인 측정 시 Peak-to-Peak < 50 mV 권장.
- ADC, RF 모듈 인근의 GND 루프 최소화.

#### 부하 변화 테스트

- 부하 스텝 변화(10%→90%)에 대한 전압 안정성 검증.
- MCU + 주변장치 최대 동작 시 전류 여유 20% 이상 확보.

#### 온도 및 발열 검토

- LDO의 전력 손실:
   $P_{loss} = (V_{in} - V_{out}) × I_{load}$
- 1 W 이상 손실 시 방열판 또는 DC-DC 전환 고려.

------

### 회로 예시 요약

```
[DC Jack 9V] --- [P-MOSFET 보호회로] --- [Buck Converter → 3.3V] --- [STM32 VDD]
                                       └─ [LDO 3.3V for Analog] --- [VDDA]
                                       └─ [5V 레일] --- [Relay, Motor]
```

------

### 설계 시 고려사항

- GND Plane은 반드시 단일 레이어로 구성하고, High-current path와 Signal path를 분리.
- USB 전원 입력 시, PC USB 포트의 최대 전류(500 mA) 제한 고려.
- 배터리 충전 회로와 전원 변환 회로 사이에 Ideal Diode 구조로 전원 자동 전환 구현.
- EMI 테스트 전, 모든 전원 라인에 Decoupling 및 Ferrite 적용 검토.

------

### 설계 검증 및 실습 확장

- Multisim, LTspice, KiCad에서 전원 회로 시뮬레이션 수행.
- 전원 라인별 전류 소모를 실측하여 설계 대비 확인.
- DC-DC 모듈과 LDO 병용 시 Ripple 전파 경로 분석.
- 전원 장애 시 Reset 회로 또는 Supervisor 동작 확인.

------

### 요약

STM32 보드 전원 회로는 단순히 “3.3 V 공급”을 넘어서,
 효율, 노이즈, 보호, 발열, 안정성의 균형을 설계해야 한다.
 적절한 전원 관리 구조를 갖춘 보드는 ADC 정확도, 통신 안정성, 전력 효율 등 전반적인 성능을 향상시키며, 장기적인 시스템 신뢰성을 확보한다.

## 25.2 Clock / Reset / SWD 회로



## 25.3 Boot0/1 구성



## 25.4 Peripheral 커넥터 핀아웃 설계



## 25.5 오실로스코프 측정 포인트



## 25.6 PCB 디자인 & DFM 검토

